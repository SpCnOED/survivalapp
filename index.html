<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vernon Survival Guide - Winter 2025</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Find local support and resources in Vernon, BC. Access crisis support, housing, food, health services, and more.">
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Vernon Guide">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- App Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%233B82F6'/%3E%3Ctext x='96' y='140' font-size='120' text-anchor='middle' fill='white' font-family='Arial, sans-serif' font-weight='bold'%3EV%3C/text%3E%3C/svg%3E">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%233B82F6'/%3E%3Ctext x='96' y='140' font-size='120' text-anchor='middle' fill='white' font-family='Arial, sans-serif' font-weight='bold'%3EV%3C/text%3E%3C/svg%3E">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .service-card { transition: all 0.2s ease; }
        .service-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }
        .category-badge { animation: fadeIn 0.3s ease; cursor: pointer; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .search-highlight { background-color: #fef3c7; font-weight: 600; padding: 0 2px; border-radius: 2px; }
        html { scroll-behavior: smooth; }
        #servicesList.appear { animation: slideDown 0.4s ease; }
        
        /* PWA Install Button Styles */
        #installButton {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .install-prompt {
            animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @media (max-width: 640px) {
            .service-card { padding: 1.25rem; }
            button, a { min-height: 44px; min-width: 44px; }
            .category-badge { min-height: 60px; }
        }
        .category-grid { display: grid; gap: 0.75rem; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
        @media (min-width: 640px) { .category-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); } }
        @media (min-width: 1024px) { .category-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); } }
        @media print { .no-print { display: none !important; } .service-card { page-break-inside: avoid; box-shadow: none; border: 1px solid #e5e7eb; } }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded z-50">Skip to content</a>

    <div class="max-w-7xl mx-auto p-4 md:p-6 lg:p-8">
        <!-- Banner Header -->
        <div class="bg-gradient-to-r from-blue-400 to-blue-500 rounded-xl shadow-lg p-6 mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-2">Vernon Survival Guide</h1>
            <p class="text-lg md:text-xl text-blue-50">Winter 2025</p>
        </div>

        <!-- Crisis Support Button -->
        <div class="mb-6 no-print">
            <button onclick="toggleCrisis()" class="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-bold py-5 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-3">
                <span class="text-3xl">üö®</span>
                <span class="text-xl">24/7 Crisis Support</span>
            </button>
        </div>

        <!-- Search Bar -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6 no-print">
            <div class="relative">
                <svg class="absolute left-3 top-3 text-gray-400" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <input
                    type="text"
                    id="searchInput"
                    placeholder="Search for services (e.g., food bank, housing, counselling)..."
                    onkeyup="handleSearch()"
                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
            </div>
        </div>

        <!-- Share Button -->
        <div class="mb-6 no-print">
            <button onclick="toggleShareQR()" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-4 px-6 rounded-xl shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-3">
                <span class="text-2xl">üì±</span>
                <span class="text-lg">Share This App</span>
            </button>
        </div>

        <!-- Image Resource Buttons -->
        <div class="mb-6 no-print grid grid-cols-2 gap-3">
            <button onclick="toggleImageModal('noShelter')" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2">
                <span class="text-xl">üö´</span>
                <span class="text-sm">No Shelter Parks</span>
            </button>
            <button onclick="toggleImageModal('fountains')" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2">
                <span class="text-xl">üíß</span>
                <span class="text-sm">Fountains & Refills</span>
            </button>
        </div>

        <!-- Category Section -->
        <div class="mb-6" id="main-content">
            <h2 class="text-2xl font-bold text-gray-900 mb-4 px-2">Browse by Category</h2>
            <div id="categoryButtons" class="category-grid mb-4"></div>
            
            <!-- Volunteer Opportunities - Full Width Button -->
            <button onclick="toggleCategory('volunteer')" id="volunteerButton" class="w-full bg-lime-50 hover:bg-lime-100 text-lime-700 border-2 border-lime-200 rounded-xl px-4 py-4 font-semibold transition-all flex items-center justify-center gap-3 shadow-sm hover:shadow-md mt-4">
                <span class="text-3xl">ü§ù</span>
                <span class="text-base">Volunteer Opportunities</span>
            </button>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <div class="flex flex-wrap items-center justify-between mb-4 gap-2 px-2">
                <div id="resultsCount" class="text-gray-600 font-medium"></div>
                <button onclick="clearCategory()" class="text-sm text-blue-600 hover:text-blue-800 font-medium">Clear category filter</button>
            </div>
            <div id="servicesList" class="space-y-4 mb-8"></div>
            <div id="noResults" class="hidden text-center py-12 bg-white rounded-xl shadow">
                <div class="text-6xl mb-4">üîç</div>
                <p class="text-gray-600 text-lg font-medium mb-2">No services found</p>
                <p class="text-gray-500 mb-4">Try different keywords or filters</p>
                <button onclick="clearFilters()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Clear All Filters</button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-12 text-center text-gray-600 text-sm pb-8">
            <p class="mb-2">If you notice incorrect information, please contact the service provider directly.</p>
            <p class="text-gray-400 mt-4 text-xs">Last updated: January 2026</p>
            <!-- Provider Access Link -->
            <button onclick="openProviderLogin()" class="mt-6 text-xs text-gray-400 hover:text-gray-600 transition-colors">
                Provider Access
            </button>
        </footer>
    </div>

    <!-- Crisis Modal -->
    <div id="crisisModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 p-4" onclick="closeModalOnBackdrop(event, 'crisisModal')">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">24/7 Crisis Support</h3>
                <button onclick="toggleCrisis()" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">√ó</button>
            </div>
            <div id="crisisNumbers" class="space-y-3"></div>
            <p class="text-xs text-gray-500 text-center mt-6">Tap any number to call immediately</p>
        </div>
    </div>

    <!-- Share QR Modal -->
    <div id="shareQRModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 p-4" onclick="closeModalOnBackdrop(event, 'shareQRModal')">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">Share This App</h3>
                <button onclick="toggleShareQR()" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">√ó</button>
            </div>
            <div class="text-center">
                <p class="text-gray-600 mb-4">Scan this QR code to share the Vernon Survival Guide with others</p>
                <div id="qrCodeContainer" class="flex justify-center mb-4"></div>
                <p class="text-sm text-gray-500">Or share this link:</p>
                <div class="mt-2 p-3 bg-gray-50 rounded-lg">
                    <code id="shareLink" class="text-sm text-blue-600"></code>
                </div>
            </div>
        </div>
    </div>

    <!-- Provider Login Modal -->
    <div id="providerLoginModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 p-4" onclick="closeModalOnBackdrop(event, 'providerLoginModal')">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">Provider Access</h3>
                <button onclick="closeProviderLogin()" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">√ó</button>
            </div>
            <p class="text-sm text-gray-600 mb-4">Enter the provider password to access network contact information.</p>
            <input 
                type="password" 
                id="providerPassword" 
                placeholder="Enter password" 
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" 
                onkeypress="if(event.key==='Enter') checkProviderPassword()"
            />
            <div id="passwordError" class="hidden text-red-600 text-sm mb-4">
                ‚ùå Incorrect password. Please try again.
            </div>
            <button 
                onclick="checkProviderPassword()" 
                class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition-colors">
                Access Provider Info
            </button>
        </div>
    </div>

    <!-- No Shelter Parks Image Modal -->
    <div id="noShelterModal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center z-50 p-4" onclick="closeModalOnBackdrop(event, 'noShelterModal')">
        <div class="bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-gray-900">No Temporary Shelter Parks</h3>
                <button onclick="toggleImageModal('noShelter')" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">√ó</button>
            </div>
            <div class="text-center">
                <img src="No_Shelter_Parks.jpg" alt="No Temporary Shelter Parks Map" class="w-full h-auto rounded-lg shadow-lg">
                <p class="text-sm text-gray-600 mt-4">Parks where temporary shelter is not permitted</p>
            </div>
        </div>
    </div>

    <!-- Fountains & Refills Image Modal -->
    <div id="fountainsModal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center z-50 p-4" onclick="closeModalOnBackdrop(event, 'fountainsModal')">
        <div class="bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-gray-900">Fountains & Refill Stations</h3>
                <button onclick="toggleImageModal('fountains')" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">√ó</button>
            </div>
            <div class="text-center">
                <img src="Fountains_Refills.jpg" alt="Fountains and Refill Stations Map" class="w-full h-auto rounded-lg shadow-lg">
                <p class="text-sm text-gray-600 mt-4">Locations of water fountains and bottle refill stations in Vernon</p>
            </div>
        </div>
    </div>

    <script>
        const VERNON_CENTER = { lat: 50.2671, lng: -119.2720 };
        
        // Provider Access Variables
        const PROVIDER_PASSWORD = "Spcno2026";
        let isProviderAuthenticated = false;
        
        // ‚ö†Ô∏è INSERT YOUR JSON DATA HERE - Replace the empty array with your data from vernon_services_data.json
        let servicesData = [];
        
        const categories = [
            { id: 'housing', name: 'Housing & Shelter', icon: 'üè†', color: 'blue', keywords: ['housing', 'shelter', 'homeless', 'rent', 'emergency shelter', 'transitional'] },
            { id: 'mental-health', name: 'Mental Health', icon: 'üß†', color: 'purple', keywords: ['mental health', 'counselling', 'therapy', 'wellness', 'peer support', 'psychiatry', 'psychological', 'crisis'] },
            { id: 'addiction', name: 'Substance Use & Recovery', icon: 'üíä', color: 'indigo', keywords: ['addiction', 'substance', 'recovery', 'harm reduction', 'detox', 'treatment', 'overdose'] },
            { id: 'food', name: 'Food & Basic Needs', icon: 'üçΩÔ∏è', color: 'green', keywords: ['food', 'nutrition', 'meal', 'lunch', 'groceries', 'food bank', 'hamper', 'kitchen', 'basic needs'] },
            { id: 'health', name: 'Physical Health', icon: '‚öïÔ∏è', color: 'red', keywords: ['health', 'medical', 'clinic', 'dental', 'nursing', 'doctor', 'hospital'] },
            { id: 'employment', name: 'Employment & Training', icon: 'üíº', color: 'amber', keywords: ['employment', 'job', 'work', 'training', 'resume', 'career', 'skills'] },
            { id: 'legal', name: 'Legal Services', icon: '‚öñÔ∏è', color: 'gray', keywords: ['legal', 'lawyer', 'court', 'law', 'advocacy', 'victim services'] },
            { id: 'indigenous', name: 'Indigenous Services', icon: 'ü¶Ö', color: 'orange', keywords: ['indigenous', 'native', 'first nations', 'm√©tis', 'metis', 'inuit', 'aboriginal', 'cultural'] },
            { id: 'youth', name: 'Youth Services', icon: 'üë•', color: 'pink', keywords: ['youth', 'teen', 'young', 'child', 'adolescent'] },
            { id: 'family', name: 'Family Support', icon: 'üë®‚Äçüë©‚Äçüëß', color: 'cyan', keywords: ['family', 'parenting', 'children', 'childcare', 'domestic'] },
            { id: 'info', name: 'Info & Education', icon: 'üìö', color: 'teal', keywords: ['information', 'education', 'learning', 'training', 'workshop', 'class', 'program', 'course', 'seminar', 'resources'] },
            { id: 'transportation', name: 'Transportation', icon: 'üöå', color: 'slate', keywords: ['transportation', 'transport', 'bus', 'transit', 'handydart', 'ride', 'travel', 'mobility'] },
            { id: 'volunteer', name: 'Volunteer Opportunities', icon: 'ü§ù', color: 'lime', keywords: ['volunteer', 'volunteering'] }
        ];
        
        const colorSchemes = {
            'blue': { bg: 'bg-blue-50', hover: 'hover:bg-blue-100', active: 'bg-blue-600', text: 'text-blue-700', activeText: 'text-white', border: 'border-blue-200', activeBorder: 'border-blue-600' },
            'purple': { bg: 'bg-purple-50', hover: 'hover:bg-purple-100', active: 'bg-purple-600', text: 'text-purple-700', activeText: 'text-white', border: 'border-purple-200', activeBorder: 'border-purple-600' },
            'green': { bg: 'bg-green-50', hover: 'hover:bg-green-100', active: 'bg-green-600', text: 'text-green-700', activeText: 'text-white', border: 'border-green-200', activeBorder: 'border-green-600' },
            'red': { bg: 'bg-red-50', hover: 'hover:bg-red-100', active: 'bg-red-600', text: 'text-red-700', activeText: 'text-white', border: 'border-red-200', activeBorder: 'border-red-600' },
            'orange': { bg: 'bg-orange-50', hover: 'hover:bg-orange-100', active: 'bg-orange-600', text: 'text-orange-700', activeText: 'text-white', border: 'border-orange-200', activeBorder: 'border-orange-600' },
            'indigo': { bg: 'bg-indigo-50', hover: 'hover:bg-indigo-100', active: 'bg-indigo-600', text: 'text-indigo-700', activeText: 'text-white', border: 'border-indigo-200', activeBorder: 'border-indigo-600' },
            'gray': { bg: 'bg-gray-50', hover: 'hover:bg-gray-100', active: 'bg-gray-600', text: 'text-gray-700', activeText: 'text-white', border: 'border-gray-200', activeBorder: 'border-gray-600' },
            'amber': { bg: 'bg-amber-50', hover: 'hover:bg-amber-100', active: 'bg-amber-600', text: 'text-amber-700', activeText: 'text-white', border: 'border-amber-200', activeBorder: 'border-amber-600' },
            'pink': { bg: 'bg-pink-50', hover: 'hover:bg-pink-100', active: 'bg-pink-600', text: 'text-pink-700', activeText: 'text-white', border: 'border-pink-200', activeBorder: 'border-pink-600' },
            'cyan': { bg: 'bg-cyan-50', hover: 'hover:bg-cyan-100', active: 'bg-cyan-600', text: 'text-cyan-700', activeText: 'text-white', border: 'border-cyan-200', activeBorder: 'border-cyan-600' },
            'lime': { bg: 'bg-lime-50', hover: 'hover:bg-lime-100', active: 'bg-lime-600', text: 'text-lime-700', activeText: 'text-white', border: 'border-lime-200', activeBorder: 'border-lime-600' },
            'teal': { bg: 'bg-teal-50', hover: 'hover:bg-teal-100', active: 'bg-teal-600', text: 'text-teal-700', activeText: 'text-white', border: 'border-teal-200', activeBorder: 'border-teal-600' },
            'slate': { bg: 'bg-slate-50', hover: 'hover:bg-slate-100', active: 'bg-slate-600', text: 'text-slate-700', activeText: 'text-white', border: 'border-slate-200', activeBorder: 'border-slate-600' }
        };
        
        let activeCategory = null;
        let searchTerm = '';
        
        function formatPhone(phone) {
            if (!phone) return '';
            const cleaned = phone.toString().replace(/\D/g, '');
            if (cleaned.length === 11 && cleaned[0] === '1') return `1-${cleaned.slice(1,4)}-${cleaned.slice(4,7)}-${cleaned.slice(7)}`;
            if (cleaned.length === 10) return `(${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6)}`;
            if (cleaned.length === 3) return cleaned;
            return phone;
        }
        
        function highlightSearchTerm(text, term) {
            if (!term || !text) return text;
            const regex = new RegExp(`(${term})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }
        
        function escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }
        function scrollToResults() { const r = document.getElementById('resultsSection'); if (r && !r.classList.contains('hidden')) r.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
        
        function matchesSearch(service, term) {
            if (!term) return true;
            const searchFields = [
                service.organization_name, 
                service.program_name, 
                service.description, 
                service.primary_category, 
                service.category_tags, 
                service.population_tags, 
                service.address, 
                service.access_notes, 
                service.eligibility
            ].filter(Boolean).join(' ').toLowerCase();
            return term.toLowerCase().split(' ').filter(Boolean).every(word => searchFields.includes(word));
        }
        
        function matchesCategory(service, categoryId) {
            if (!categoryId) return true;
            if (categoryId === 'volunteer') {
                return service.volunteer_url && service.volunteer_url.trim() !== '';
            }
            const category = categories.find(c => c.id === categoryId);
            if (!category) return true;
            const serviceText = [service.primary_category, service.category_tags, service.description, service.organization_name, service.program_name].filter(Boolean).join(' ').toLowerCase();
            return category.keywords.some(keyword => serviceText.includes(keyword));
        }
        
        function renderCategories() {
            const container = document.getElementById('categoryButtons');
            const regularCategories = categories.filter(c => c.id !== 'volunteer');
            container.innerHTML = regularCategories.map(cat => {
                const scheme = colorSchemes[cat.color];
                const isActive = activeCategory === cat.id;
                return `
                    <button onclick="toggleCategory('${cat.id}')" 
                        class="category-badge ${isActive ? scheme.active + ' ' + scheme.activeText : scheme.bg + ' ' + scheme.text + ' ' + scheme.hover} 
                        border-2 ${isActive ? scheme.activeBorder : scheme.border} rounded-xl px-4 py-4 font-semibold transition-all 
                        flex flex-col items-center justify-center gap-2 shadow-sm hover:shadow-md">
                        <span class="text-3xl">${cat.icon}</span>
                        <span class="text-xs text-center leading-tight">${cat.name}</span>
                    </button>
                `;
            }).join('');
        }
        
        function toggleCategory(categoryId) {
            if (activeCategory === categoryId) {
                activeCategory = null;
            } else {
                activeCategory = categoryId;
            }
            renderCategories();
            updateVolunteerButton();
            renderServices();
            scrollToResults();
        }
        
        function updateVolunteerButton() {
            const btn = document.getElementById('volunteerButton');
            if (activeCategory === 'volunteer') {
                btn.className = 'w-full bg-lime-600 text-white border-2 border-lime-600 rounded-xl px-4 py-4 font-semibold transition-all flex items-center justify-center gap-3 shadow-md mt-4';
            } else {
                btn.className = 'w-full bg-lime-50 hover:bg-lime-100 text-lime-700 border-2 border-lime-200 rounded-xl px-4 py-4 font-semibold transition-all flex items-center justify-center gap-3 shadow-sm hover:shadow-md mt-4';
            }
        }
        
        function clearCategory() {
            activeCategory = null;
            renderCategories();
            updateVolunteerButton();
            renderServices();
        }
        
        function handleSearch() {
            searchTerm = document.getElementById('searchInput').value;
            renderServices();
            if (searchTerm) scrollToResults();
        }
        
        function clearFilters() {
            activeCategory = null;
            searchTerm = '';
            document.getElementById('searchInput').value = '';
            renderCategories();
            updateVolunteerButton();
            renderServices();
        }
        
        function renderServices() {
            const filtered = servicesData.filter(service => 
                matchesSearch(service, searchTerm) && matchesCategory(service, activeCategory)
            );
            
            const servicesList = document.getElementById('servicesList');
            const resultsSection = document.getElementById('resultsSection');
            const noResults = document.getElementById('noResults');
            const resultsCount = document.getElementById('resultsCount');
            
            if (filtered.length === 0 && (searchTerm || activeCategory)) {
                servicesList.innerHTML = '';
                noResults.classList.remove('hidden');
                resultsSection.classList.remove('hidden');
                resultsCount.textContent = '';
            } else if (searchTerm || activeCategory) {
                noResults.classList.add('hidden');
                resultsSection.classList.remove('hidden');
                resultsCount.textContent = `Found ${filtered.length} service${filtered.length !== 1 ? 's' : ''}`;
                servicesList.innerHTML = filtered.map(service => renderServiceCard(service)).join('');
                servicesList.classList.add('appear');
            } else {
                resultsSection.classList.add('hidden');
            }
        }
        
        function renderServiceCard(service) {
            const phone = service.program_phone || service.org_main_phone;
            const email = service.program_email || service.org_general_email;
            const hasLocation = service.y && service.x;  // y = latitude, x = longitude
            
            let hoursHtml = '';
            const days = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
            const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const hasHours = days.some(day => service[`${day}_hours`]);
            
            if (hasHours) {
                hoursHtml = '<div class="mt-3 p-3 bg-blue-50 rounded border border-blue-200"><p class="font-semibold text-sm text-gray-800 mb-2">Operating Hours:</p><div class="text-sm text-gray-700 space-y-1">';
                days.forEach((day, idx) => {
                    const hours = service[`${day}_hours`];
                    if (hours) {
                        hoursHtml += `<div><span class="font-medium">${dayNames[idx]}:</span> ${hours}</div>`;
                    }
                });
                hoursHtml += '</div></div>';
            }
            
            return `
                <div class="service-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow p-5">
                    <div class="mb-3">
                        <h3 class="text-xl font-bold text-gray-800 mb-1">${highlightSearchTerm(service.organization_name, searchTerm)}</h3>
                        ${service.program_name ? `<p class="text-md text-blue-600 font-medium mb-2">${highlightSearchTerm(service.program_name, searchTerm)}</p>` : ''}
                        ${service.primary_category ? `<span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${service.primary_category}</span>` : ''}
                    </div>
                    
                    ${service.description ? `<p class="text-gray-700 mb-3">${highlightSearchTerm(service.description, searchTerm)}</p>` : ''}
                    ${service.eligibility ? `<div class="mb-3 p-3 bg-green-50 rounded border border-green-200"><p class="text-sm text-gray-700"><strong>Eligibility:</strong> ${service.eligibility}</p></div>` : ''}
                    
                    <div class="space-y-2 text-sm">
                        ${service.address ? `
                            <div class="flex items-start text-gray-600">
                                <svg class="mr-2 flex-shrink-0 mt-0.5" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                                </svg>
                                <div class="flex-1">
                                    <span>${service.address}</span>
                                    ${hasLocation ? `
                                        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(service.organization_name + ', ' + service.address)}&query_place_id=${service.y},${service.x}" 
                                           target="_blank" 
                                           class="ml-2 text-blue-600 hover:text-blue-800 underline">
                                            üìç View on Map
                                        </a>
                                    ` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${service.has_wifi ? `
                            <div class="flex items-start text-gray-600">
                                <svg class="mr-2 flex-shrink-0 mt-0.5" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M17.778 8.222c-4.296-4.296-11.26-4.296-15.556 0A1 1 0 01.808 6.808c5.076-5.077 13.308-5.077 18.384 0a1 1 0 01-1.414 1.414zM14.95 11.05a7 7 0 00-9.9 0 1 1 0 01-1.414-1.414 9 9 0 0112.728 0 1 1 0 01-1.414 1.414zM12.12 13.88a3 3 0 00-4.242 0 1 1 0 01-1.415-1.415 5 5 0 017.072 0 1 1 0 01-1.415 1.415zM9 16a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z"/>
                                </svg>
                                <span class="text-green-600 font-medium">üì∂ Free WiFi</span>
                            </div>
                        ` : ''}
                        
                        ${phone ? `
                            <div class="flex items-start text-gray-600">
                                <svg class="mr-2 flex-shrink-0 mt-0.5" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                </svg>
                                <a href="tel:${phone}" class="text-blue-600 hover:underline break-all">${formatPhone(phone)}</a>
                            </div>
                        ` : ''}
                        
                        ${service.phone_24h ? `
                            <div class="flex items-start text-gray-600">
                                <svg class="mr-2 flex-shrink-0 mt-0.5" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                </svg>
                                <div>
                                    <span class="text-red-600 font-medium">24/7: </span>
                                    <a href="tel:${service.phone_24h}" class="text-blue-600 hover:underline ml-1">${formatPhone(service.phone_24h)}</a>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${service.text_number ? `
                            <div class="flex items-start text-gray-600">
                                <svg class="mr-2 flex-shrink-0" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                </svg>
                                <span class="text-gray-700">Text: ${formatPhone(service.text_number)}</span>
                            </div>
                        ` : ''}
                        
                        ${service.phone_helpline ? `
                            <div class="flex items-start text-gray-600">
                                <svg class="mr-2 flex-shrink-0 mt-0.5" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                </svg>
                                <div>
                                    <span class="text-gray-700 font-medium">Helpline: </span>
                                    <a href="tel:${service.phone_helpline}" class="text-blue-600 hover:underline ml-1">${formatPhone(service.phone_helpline)}</a>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${email ? `
                            <div class="flex items-start text-gray-600">
                                <svg class="mr-2 flex-shrink-0" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                </svg>
                                <a href="mailto:${email}" class="text-blue-600 hover:underline break-all">${email}</a>
                            </div>
                        ` : ''}
                        
                        ${service.org_website ? `
                            <div class="flex items-start text-gray-600">
                                <svg class="mr-2 flex-shrink-0" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.083 9h1.946c.089-1.546.383-2.97.837-4.118A6.004 6.004 0 004.083 9zM10 2a8 8 0 100 16 8 8 0 000-16zm0 2c-.076 0-.232.032-.465.262-.238.234-.497.623-.737 1.182-.389.907-.673 2.142-.766 3.556h3.936c-.093-1.414-.377-2.649-.766-3.556-.24-.56-.5-.948-.737-1.182C10.232 4.032 10.076 4 10 4zm3.971 5c-.089-1.546-.383-2.97-.837-4.118A6.004 6.004 0 0115.917 9h-1.946zm-2.003 2H8.032c.093 1.414.377 2.649.766 3.556.24.56.5.948.737 1.182.233.23.389.262.465.262.076 0 .232-.032.465-.262.238-.234.498-.623.737-1.182.389-.907.673-2.142.766-3.556zm1.166 4.118c.454-1.147.748-2.572.837-4.118h1.946a6.004 6.004 0 01-2.783 4.118zm-6.268 0C6.412 13.97 6.118 12.546 6.03 11H4.083a6.004 6.004 0 002.783 4.118z" clip-rule="evenodd"/>
                                </svg>
                                <a href="${service.org_website.startsWith('http') ? service.org_website : 'https://' + service.org_website}" 
                                   target="_blank" 
                                   rel="noopener noreferrer" 
                                   class="text-blue-600 hover:underline break-all">Visit Website</a>
                            </div>
                        ` : ''}
                        
                        ${isProviderAuthenticated && (service.org_provider_phone || service.org_provider_email) ? `
                            <div class="mt-3 p-3 bg-purple-50 rounded border-2 border-purple-300">
                                <p class="text-xs font-semibold text-purple-900 mb-2">üîí PROVIDER NETWORK CONTACT</p>
                                ${service.org_provider_phone ? `
                                    <div class="flex items-center text-gray-700 mb-2">
                                        <svg class="mr-2 flex-shrink-0" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                        </svg>
                                        <span class="font-semibold mr-2">Provider Phone:</span>
                                        <a href="tel:${service.org_provider_phone}" class="text-purple-700 hover:underline font-semibold">
                                            ${formatPhone(service.org_provider_phone)}
                                        </a>
                                    </div>
                                ` : ''}
                                ${service.org_provider_email ? `
                                    <div class="flex items-center text-gray-700">
                                        <svg class="mr-2 flex-shrink-0" width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                        </svg>
                                        <span class="font-semibold mr-2">Provider Email:</span>
                                        <a href="mailto:${service.org_provider_email}" class="text-purple-700 hover:underline font-semibold">
                                            ${service.org_provider_email}
                                        </a>
                                    </div>
                                ` : ''}
                                ${service.org_provider_notes ? `
                                    <div class="mt-2 pt-2 border-t border-purple-200">
                                        <p class="text-sm text-purple-900">
                                            <span class="font-semibold">üìù Notes:</span> ${service.org_provider_notes}
                                        </p>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        ${service.volunteer_url ? `
                            <div class="mt-3">
                                <a href="${service.volunteer_url}" 
                                   target="_blank" 
                                   rel="noopener noreferrer"
                                   class="inline-flex items-center px-4 py-2 bg-lime-600 text-white rounded-lg hover:bg-lime-700 transition-colors">
                                    <span class="mr-2">ü§ù</span>
                                    <span class="font-semibold">Volunteer Here</span>
                                </a>
                            </div>
                        ` : ''}
                        
                        ${hoursHtml}
                        
                        ${service.access_notes ? `
                            <div class="mt-3 p-3 bg-yellow-50 rounded border border-yellow-200">
                                <p class="text-sm text-gray-700"><strong>Note:</strong> ${service.access_notes}</p>
                            </div>
                        ` : ''}
                        
                        ${service.is_seasonal ? `
                            <div class="mt-3 p-3 bg-orange-50 rounded border border-orange-200">
                                <p class="text-sm text-gray-700">
                                    <strong>‚ö†Ô∏è Seasonal Service</strong>
                                    ${service.season_notes ? `: ${service.season_notes}` : ''}
                                </p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        function loadCrisisNumbers() {
            const crisisServices = servicesData.filter(s => s.phone_24h);
            const container = document.getElementById('crisisNumbers');
            
            // Always include 911 first
            let html = `
                <a href="tel:911" class="block bg-red-600 text-white rounded-lg p-4 hover:bg-red-700 transition-colors mb-3">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="font-bold text-lg">Emergency Services</div>
                            <div class="text-sm opacity-90">Police, Fire, Ambulance</div>
                            <div class="text-2xl font-bold mt-1">911</div>
                        </div>
                        <span class="text-4xl">üö®</span>
                    </div>
                </a>
            `;
            
            crisisServices.forEach(service => {
                if (service.phone_24h) {
                    html += `
                        <a href="tel:${service.phone_24h}" class="block bg-red-50 border-2 border-red-200 rounded-lg p-4 hover:bg-red-100 transition-colors mb-3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-bold text-gray-800 text-lg">${service.organization_name}</div>
                                    ${service.program_name ? `<div class="text-sm text-gray-600">${service.program_name}</div>` : ''}
                                    <div class="text-xl font-bold text-red-600 mt-1">${formatPhone(service.phone_24h)}</div>
                                </div>
                                <span class="text-4xl">üìû</span>
                            </div>
                        </a>
                    `;
                }
            });
            
            container.innerHTML = html;
        }
        
        function toggleCrisis() {
            const modal = document.getElementById('crisisModal');
            modal.classList.toggle('active');
            if (modal.classList.contains('active')) {
                loadCrisisNumbers();
            }
        }
        
        function toggleShareQR() {
            const modal = document.getElementById('shareQRModal');
            modal.classList.toggle('active');
            if (modal.classList.contains('active')) {
                const url = window.location.href;
                document.getElementById('shareLink').textContent = url;
                const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}`;
                document.getElementById('qrCodeContainer').innerHTML = `<img src="${qrUrl}" alt="QR Code" class="rounded-lg shadow-md">`;
            }
        }
        
        // Image Modal Toggle Function
        function toggleImageModal(type) {
            if (type === 'noShelter') {
                const modal = document.getElementById('noShelterModal');
                modal.classList.toggle('active');
            } else if (type === 'fountains') {
                const modal = document.getElementById('fountainsModal');
                modal.classList.toggle('active');
            }
        }
        
        // Provider Access Functions
        function openProviderLogin() {
            if (isProviderAuthenticated) {
                alert('‚úÖ You are already logged in as a provider.\n\nProvider contact information is now visible in all service cards.');
                return;
            }
            document.getElementById('providerLoginModal').classList.add('active');
            document.getElementById('providerPassword').focus();
        }
        
        function closeProviderLogin() {
            document.getElementById('providerLoginModal').classList.remove('active');
            document.getElementById('providerPassword').value = '';
            document.getElementById('passwordError').classList.add('hidden');
        }
        
        function checkProviderPassword() {
            const password = document.getElementById('providerPassword').value;
            const errorDiv = document.getElementById('passwordError');
            
            if (password === PROVIDER_PASSWORD) {
                isProviderAuthenticated = true;
                closeProviderLogin();
                renderServices(); // Refresh service cards to show provider info
                alert('‚úÖ Provider access granted!\n\nNetwork contact information is now visible in all service cards.');
            } else {
                errorDiv.classList.remove('hidden');
                document.getElementById('providerPassword').value = '';
                document.getElementById('providerPassword').focus();
            }
        }
        
        function closeModalOnBackdrop(event, modalId) {
            if (event.target.id === modalId) {
                document.getElementById(modalId).classList.remove('active');
            }
        }
        
        // PWA Functionality
        let deferredPrompt;
        let installButton;
        
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker registered successfully:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
        
        // Capture install prompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show install button
            showInstallButton();
        });
        
        // Show install button
        function showInstallButton() {
            // Create install button if it doesn't exist
            if (!document.getElementById('installButton')) {
                const header = document.querySelector('.max-w-6xl > div:first-child');
                if (header) {
                    const installBtn = document.createElement('button');
                    installBtn.id = 'installButton';
                    installBtn.className = 'install-prompt w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-3 mb-4';
                    installBtn.innerHTML = `
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                        </svg>
                        <span>üì≤ Install App - Works Offline!</span>
                    `;
                    installBtn.onclick = installApp;
                    header.insertBefore(installBtn, header.firstChild.nextSibling);
                    installButton = installBtn;
                }
            }
        }
        
        // Install app function
        async function installApp() {
            if (!deferredPrompt) {
                alert('‚ÑπÔ∏è To install:\n\n1. Tap the Share button\n2. Select "Add to Home Screen"\n3. Tap "Add"');
                return;
            }
            
            // Show the install prompt
            deferredPrompt.prompt();
            
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('‚úÖ User accepted the install prompt');
                // Hide install button
                if (installButton) {
                    installButton.style.display = 'none';
                }
            } else {
                console.log('‚ùå User dismissed the install prompt');
            }
            
            // Clear the deferred prompt
            deferredPrompt = null;
        }
        
        // Listen for app installed event
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA was installed');
            if (installButton) {
                installButton.style.display = 'none';
            }
            deferredPrompt = null;
        });
        
        // Check if app is already installed (standalone mode)
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            console.log('‚úÖ App is running in standalone mode (installed)');
        }
        
        // Initialize
        renderCategories();
        updateVolunteerButton();
    </script>
</body>
</html>
